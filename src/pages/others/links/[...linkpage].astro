---
import CompactCard from '../../../components/feed/CompactCard.astro';
import CompactGrid from '../../../components/feed/CompactGrid.astro';
import ProjectLayout from '../../../layouts/ProjectLayout.astro';
import { getCollection } from 'astro:content';

export async function getStaticPaths() {
  const entries = await getCollection('links');

  return entries.map(entry => {
    const slug = entry.slug;
    const isIndex = entry.id.endsWith('/index.md') || entry.id === 'index.md';
    
    
    const segments = slug.split('/');
    //this is used to get only direct children
    const depth = segments.length;
    const childItems = isIndex
      ? entries.filter(e => e.slug.startsWith(slug + '/') && e.slug !== slug && e.slug.split('/').length === depth + 1)
      : [];

    

    // Build breadcrumb for this entry
    const breadcrumb = segments.map((_, idx, arr) => {
      const partial = arr.slice(0, idx + 1).join('/');
      const segEntry = entries.find(e => e.slug === partial);
      const label = (segEntry as any)?.data?.title || arr[idx];
      return { partial, label, url: `/others/links/${partial}/`, current: idx === arr.length - 1 };
    });

    breadcrumb.unshift({ partial: 'others/links', label: 'links', url: '/others/links/', current: false });

    const parentPage = breadcrumb.length > 1 ? { title: breadcrumb[breadcrumb.length - 2].label, url: breadcrumb[breadcrumb.length - 2].url } : null;
    
    return {
      params: { linkpage: slug },
      props: { slug, mainEntry: entry, childItems, isIndex, breadcrumb, parentPage }
    };
  });
}
const { slug, mainEntry, childItems, isIndex, breadcrumb, parentPage } = Astro.props as any;
---

<ProjectLayout
  collection="links"
  slug={slug}
  mainEntry={mainEntry}
  isIndex={isIndex}
  breadcrumb={breadcrumb}
  parentPage={parentPage}
>
<CompactGrid  minWidth="14rem"
  gap="0.85rem">
    {childItems.map((e: any) => (
      <CompactCard
        url={`/others/links/${e.slug}/`}
        title={e.data.title}
        pubDate={e.data.pubDate}
        description={e.data.description}
        icon={e.data.icon}
      />
    ))}
  </CompactGrid>

</ProjectLayout>

