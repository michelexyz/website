---
import ProjectLayout from '../../layouts/ProjectLayout.astro';
import { getCollection } from 'astro:content';

export async function getStaticPaths() {
  const entries = await getCollection('projects');

  return entries.map(entry => {
    const slug = entry.slug;
    const isIndex = entry.id.endsWith('/index.md') || entry.id === 'index.md';
    const childItems = isIndex
      ? entries.filter(e => e.slug.startsWith(slug + '/') && e.slug !== slug)
      : [];
    // Build breadcrumb for this entry
    const segments = slug.split('/');
    const breadcrumb = segments.map((_, idx, arr) => {
      const partial = arr.slice(0, idx + 1).join('/');
      const segEntry = entries.find(e => e.slug === partial);
      const label = (segEntry as any)?.data?.title || arr[idx];
      return { partial, label, url: `/projects/${partial}/`, current: idx === arr.length - 1 };
    });
    return {
      params: { project: slug },
      props: { slug, mainEntry: entry, childItems, isIndex, breadcrumb }
    };
  });
}
const { slug, mainEntry, childItems, isIndex, breadcrumb } = Astro.props as any;
---

<ProjectLayout
  collection="projects"
  slug={slug}
  mainEntry={mainEntry}
  childItems={childItems}
  isIndex={isIndex}
  breadcrumb={breadcrumb}
/>
